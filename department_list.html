<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Departments</title>
<link rel="stylesheet" href="admin_dashboard.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
<style>
.register-btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  background: linear-gradient(135deg, #327070, #327070);
  color: #fff;
  border: none;
  border-radius: 8px;
  padding: 12px 20px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  box-shadow: 0 4px 10px rgba(76, 175, 80, 0.3);
  transition: all 0.2s ease-in-out;
  margin-top: 20px;
}
.register-btn:hover {
  transform: translateY(-2px);
  background: linear-gradient(135deg, #45A049, #3e8e41);
  box-shadow: 0 6px 14px rgba(76, 175, 80, 0.4);
}
.register-btn i {
  font-size: 18px;
}

/* Giữa nút với bảng */
.table-section {
  margin-top: 20px;
}
.search-box {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 15px;
}

.search-box input {
  flex: 1;
  padding: 8px 12px;
  border: 1px solid #ccc;
  border-radius: 8px;
  font-size: 14px;
  outline: none;
  transition: border-color 0.2s;
}

.search-box input:focus {
  border-color: #4CAF50;
}

.search-box i {
  color: #4CAF50;
  font-size: 18px;
}
</style>
</head>
<body>
<div class="dashboard-container">
    <aside class="sidebar">
        <div class="logo">
            <h2>Admin</h2>
        </div>
        <ul class="menu">
          <li onclick="location.href='admin_dashboard.html'"><i class="fas fa-home"></i> Dashboard</li>
          <li onclick="location.href='employee_list.html'"><i class="fas fa-users"></i> Employees</li>
          <li class="active" onclick="location.href='department_list.html'"><i class="fas fa-building"></i> Departments</li>
          <li onclick="location.href='attendance_list.html'"><i class="fas fa-calendar-check"></i> Attendance</li>
          <li onclick="location.href='shift_list.html'"><i class="fas fa-clock"></i> Work Shifts</li>
          <li onclick="location.href='schedule_list.html'"><i class="fas fa-calendar-alt"></i> Work Schedule</li>
          <li onclick="handleLogout()"><i class="fas fa-sign-out-alt"></i> Logout</li>
        </ul>
    </aside>

    <main class="main-content">
        <header>
            <h1>Departments</h1>
        </header>
        <div class="search-box">
          <i class="fas fa-search"></i>
          <input type="text" id="searchInput" placeholder="Search by Department ID..." oninput="filterDepartments()">
        </div>
        <button class="register-btn" id="registerBtn" onclick="goRegisterDepartment()">
            <i class="fas fa-plus-circle"></i> Register Department
        </button>
        <section class="table-section">
            <table>
                <thead>
                    <tr>
                        <th>Department ID</th>
                        <th>Department Name</th>
                    </tr>
                </thead>
                <tbody id="departmentTable"></tbody>
            </table>
        </section>


    </main>
</div>

<script>
let departmentData = []; 

async function loadDepartments() {
  try {
    const response = await fetch("http://localhost:5000/api/departments");
    const data = await response.json();
    departmentData = data.success ? data.departments : data;
    renderDepartments(departmentData);
  } catch (error) {
    console.error("Error loading departments:", error);
  }
}

function renderDepartments(data) {
  const tableBody = document.getElementById("departmentTable");
  tableBody.innerHTML = "";

  if (data.length === 0) {
    tableBody.innerHTML = "<tr><td colspan='2'>No departments found</td></tr>";
    return;
  }

  data.forEach(dep => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${dep.DepartmentID}</td>
      <td>${dep.DepartmentName}</td>
    `;
    tableBody.appendChild(row);
  });
}

function filterDepartments() {
  const keyword = document.getElementById("searchInput").value.trim().toLowerCase();
  const filtered = departmentData.filter(dep =>
    dep.DepartmentID.toLowerCase().includes(keyword)
  );
  renderDepartments(filtered);
}

function goRegisterDepartment() {
  location.href = "register_department.html";
}

function handleLogout() {
  sessionStorage.removeItem('employeeName');
  sessionStorage.removeItem('employeeID');
  window.location.href = 'login.html';
}

loadDepartments();
</script>
</body>
</html>
