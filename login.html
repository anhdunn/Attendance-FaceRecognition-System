<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Attendance - Login</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link rel="stylesheet" href="login.css">
</head>
<body>
<!-- Support Button -->
<a href="support.html" class="support-btn">
    <i class="fa-solid fa-circle-question"></i>
</a>

<div class="login-container">
    <h2>Attendance System</h2>
    <p class="subtitle"></p>

    <div class="login-section">
        <input type="text" id="employeeID" placeholder="Employee ID" class="input-line">

        <div class="password-wrapper">
            <input type="password" id="password" placeholder="Password" class="input-line">
            <i class="fa-solid fa-eye togglePassword" id="togglePassword"></i>
        </div>

        <button onclick="login()">Login</button>
        <a href="forgot_password.html" class="forgot-link">Forgot Password?</a>
        <p id="statusMsg"></p>
    </div>
</div>

<script>
async function login() {
    const id = document.getElementById('employeeID').value.trim();
    const pass = document.getElementById('password').value.trim();
    const status = document.getElementById('statusMsg');

    if (!id || !pass) {
        status.textContent = "Please enter both Employee ID and Password.";
        status.style.color = "red";
        return;
    }

    try {
        const response = await fetch('http://localhost:5000/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ employeeID: id, password: pass })
        });

        const data = await response.json();

        if (data.success) {
            sessionStorage.setItem('employeeID', data.employee.EmployeeID);
            sessionStorage.setItem('employeeName', data.employee.FullName);
            sessionStorage.setItem('employeeRole', data.employee.Role);
            status.textContent = "Login successful!";
            status.style.color = "lightgreen";

            setTimeout(() => {
                if (data.employee.Role === 'Admin') {
                    location.href = 'admin_dashboard.html';
                } else {
                    location.href = 'mainform.html';
                }
            }, 600);
        } else {
            status.textContent = data.message;
            status.style.color = "red";
        }
    } catch (error) {
        status.textContent = "Error connecting to server.";
        status.style.color = "red";
        console.error(error);
    }
}

document.getElementById("togglePassword").addEventListener("click", function () {
    const passwordField = document.getElementById("password");
    const icon = this;

    if (passwordField.type === "password") {
        passwordField.type = "text";
        icon.classList.replace("fa-eye", "fa-eye-slash");
    } else {
        passwordField.type = "password";
        icon.classList.replace("fa-eye-slash", "fa-eye");
    }
});
document.addEventListener("keydown", function (event) {
    if (event.key === "Enter") {
        event.preventDefault(); // Ngăn reload trang mặc định
        login();
    }
});
</script>

</body>
</html>
